<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Objednávky jídelny</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f5f7; margin:0; padding:20px; display:flex; justify-content:center;}
  .container { max-width:900px; width:100%; }
  .days { display:flex; gap:10px; margin-bottom:20px; flex-wrap: wrap; }
  .day-card { flex:1; padding:12px; background:#fff; border-radius:12px; text-align:center; cursor:pointer;
    box-shadow:0 2px 8px rgba(0,0,0,0.08); transition: transform 0.2s, background 0.2s; }
  .day-card:hover { transform: translateY(-2px); background:#e8f0ff; }
  .day-card.active { background:#2563eb; color:#fff; box-shadow:0 4px 12px rgba(0,0,0,0.15); }
  .menu-card, .order-card { background:#fff; border-radius:12px; padding:20px; margin-bottom:20px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
  label { display:block; margin-top:10px; }
  select, input[type="number"], input[type="text"] { width:100%; padding:8px; margin-top:4px; border-radius:8px; border:1px solid #ccc; }
  button { margin-top:12px; padding:12px 20px; border:none; border-radius:12px; background:#2563eb; color:#fff; font-size:16px; cursor:pointer; transition: background 0.2s; }
  button:hover { background:#1e4bb8; }
  button.delete { background:#ff4d4f; margin-left:10px; }
  .order-item { background:#f9fbff; padding:10px; border-radius:8px; margin-top:8px; display:flex; justify-content:space-between; align-items:center; }
  .hidden { display:none; }
</style>
</head>
<body>
<div class="container">
  <h1>Jídelna — objednávky</h1>

  <div class="days" id="daysContainer"></div>

  <div class="menu-card hidden" id="menuCard">
    <h3 id="menuDayTitle"></h3>
    <div id="menuContent">
      <p><strong>Polévka:</strong> <span id="menuPolevka"></span></p>
      <p><strong>Jídlo 1:</strong> <span id="menuJidlo1"></span></p>
      <p><strong>Jídlo 2:</strong> <span id="menuJidlo2"></span></p>
    </div>
    <div id="menuSelection">
      <label>Typ menu:
        <select id="menuTypeSelect">
          <option value="Celé menu">Celé menu</option>
          <option value="Poloviční menu">Poloviční menu</option>
          <option value="Půl+Půl menu">Půl+Půl menu</option>
          <option value="Hlavní jídlo">Hlavní jídlo</option>
          <option value="Poloviční hlavní jídlo">Poloviční hlavní jídlo</option>
          <option value="Polévka">Polévka</option>
        </select>
      </label>
      <label id="selectMainLabel" class="hidden">Vyber hlavní jídlo:
        <select id="selectMain">
          <option value="jidlo1">Jídlo 1</option>
          <option value="jidlo2">Jídlo 2</option>
        </select>
      </label>
      <label>Počet porcí:
        <input type="number" id="portionCount" min="1" value="1">
      </label>
      <button id="addOrderBtn">Přidat do objednávky</button>
    </div>
  </div>

  <div class="order-card" id="ordersCard">
    <h3>Finální objednávka</h3>
    <div id="orderList"></div>
    <p><strong>Celkem:</strong> <span id="totalPrice">0</span> Kč</p>

    <label>Jméno:
      <input type="text" id="userName" placeholder="Vaše jméno">
    </label>
    <label>Kontakt (např. e-mail nebo telefon):
      <input type="text" id="userContact" placeholder="Kontakt">
    </label>
    <label>Doručení:
      <select id="deliverySelect">
        <option value="Vyzvednu">Vyzvednu</option>
        <option value="Přivézt">Přivézt</option>
      </select>
    </label>
    <label id="addressLabel" class="hidden">Adresa:
      <input type="text" id="addressInput" placeholder="Ulice, číslo, město">
    </label>

    <button id="submitOrderBtn">Odeslat objednávku</button>
  </div>
</div>

<script>
const APP_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwd1mpQosHJxpTHtun7LXMltMEY1I5ZtvkcMcqfmrS7yJ3DfxgBh6twTCQdEHmkOcKs/exec';

let weekMenu = [];
let priceList = {
  'Polévka': 40,
  'Hlavní jídlo': 135,
  'Poloviční menu': 115,
  'Celé menu': 155,
  'Poloviční hlavní jídlo': 115,
  'Půl+Půl menu': 155
};
let activeDayIndex = null;
let orders = [];

const daysContainer = document.getElementById('daysContainer');
const menuCard = document.getElementById('menuCard');
const menuDayTitle = document.getElementById('menuDayTitle');
const menuPolevka = document.getElementById('menuPolevka');
const menuJidlo1 = document.getElementById('menuJidlo1');
const menuJidlo2 = document.getElementById('menuJidlo2');
const menuTypeSelect = document.getElementById('menuTypeSelect');
const selectMainLabel = document.getElementById('selectMainLabel');
const selectMain = document.getElementById('selectMain');
const portionCount = document.getElementById('portionCount');
const addOrderBtn = document.getElementById('addOrderBtn');
const orderList = document.getElementById('orderList');
const totalPriceEl = document.getElementById('totalPrice');
const submitOrderBtn = document.getElementById('submitOrderBtn');
const deliverySelect = document.getElementById('deliverySelect');
const addressLabel = document.getElementById('addressLabel');
const addressInput = document.getElementById('addressInput');
const userName = document.getElementById('userName');
const userContact = document.getElementById('userContact');

// --- LOCAL STORAGE ---
window.addEventListener('load', () => {
  const savedName = localStorage.getItem('userName');
  if (savedName) userName.value = savedName;
});
userName.addEventListener('input', () => {
  localStorage.setItem('userName', userName.value.trim());
});

// --- načtení menu týdne ---
async function loadWeekMenu() {
  try {
    const res = await fetch(APP_SCRIPT_URL);
    if (!res.ok) throw new Error('Chyba síťového požadavku ' + res.status);
    const data = await res.json();
    weekMenu = data.week.filter((_, i) => i < 5);
    renderDayCards();
  } catch(err) {
    console.error('Chyba při načítání menu týdne:', err);
  }
}

// --- vykreslení karet dnů ---
function renderDayCards() {
  daysContainer.innerHTML = '';
  weekMenu.forEach((item, idx) => {
    const day = item.row;
    const div = document.createElement('div');
    div.className = 'day-card';
    const date = new Date(day.date);
    const formattedDate = date.toLocaleDateString('cs-CZ', { day:'2-digit', month:'2-digit' });
    div.textContent = `${day.dayName} (${formattedDate})`;
    div.addEventListener('click', () => selectDay(idx));
    daysContainer.appendChild(div);
  });
}

// --- výběr dne ---
function selectDay(idx) {
  activeDayIndex = idx;
  const cards = document.querySelectorAll('.day-card');
  cards.forEach((c,i) => c.classList.toggle('active', i === idx));
  const day = weekMenu[idx].row;
  menuCard.classList.remove('hidden');
  const formattedDate = new Date(day.date).toLocaleDateString('cs-CZ', { day:'2-digit', month:'2-digit' });
  menuDayTitle.textContent = `${day.dayName} (${formattedDate})`;
  menuPolevka.textContent = day.polevka || '–';
  menuJidlo1.textContent = day.jidlo1 || '–';
  menuJidlo2.textContent = day.jidlo2 || '–';
  menuTypeSelect.value = 'Celé menu';
  selectMainLabel.classList.remove('hidden');
  portionCount.value = 1;
}

// --- volba typu menu ---
menuTypeSelect.addEventListener('change', () => {
  const t = menuTypeSelect.value;
  if (['Celé menu','Poloviční menu','Hlavní jídlo','Poloviční hlavní jídlo'].includes(t))
    selectMainLabel.classList.remove('hidden');
  else
    selectMainLabel.classList.add('hidden');
});

// --- doručení ---
deliverySelect.addEventListener('change', () => {
  addressLabel.classList.toggle('hidden', deliverySelect.value !== 'Přivézt');
});

// --- přidání objednávky ---
addOrderBtn.addEventListener('click', () => {
  if (activeDayIndex === null) return alert('Vyberte den!');
  const day = weekMenu[activeDayIndex].row;
  const type = menuTypeSelect.value;
  const mainChoice = selectMain.value;
  const qty = parseInt(portionCount.value, 10) || 1;
  const basePrice = priceList[type] || 0;
  const price = basePrice * qty;
  orders.push({ day: day.dayName, date: day.date, type, mainChoice, qty, price });
  renderOrders();
});

// --- vykreslení objednávek ---
function renderOrders() {
  orderList.innerHTML = '';
  let total = 0;
  orders.forEach((o, i) => {
    total += o.price;
    const div = document.createElement('div');
    div.className = 'order-item';
    div.innerHTML = `<span>${o.day} | ${o.type}${o.mainChoice ? ' – ' + o.mainChoice : ''} x${o.qty} = ${o.price} Kč</span>`;
    const btn = document.createElement('button');
    btn.textContent = 'Smazat';
    btn.className = 'delete';
    btn.addEventListener('click', () => { orders.splice(i,1); renderOrders(); });
    div.appendChild(btn);
    orderList.appendChild(div);
  });
  totalPriceEl.textContent = total;
}

// --- odeslání objednávky ---
submitOrderBtn.addEventListener('click', async () => {
  if (orders.length === 0) return alert('Žádná položka v objednávce');
  const name = userName.value.trim();
  const contact = userContact.value.trim();
  const delivery = deliverySelect.value;
  const address = (delivery === 'Přivézt') ? addressInput.value.trim() : '';

  if (!name) return alert('Zadejte jméno');
  if (!contact) return alert('Zadejte kontakt');
  if (delivery === 'Přivézt' && !address) return alert('Zadejte adresu');

  const payload = { orders, name, contact, delivery, address };
  try {
    const res = await fetch(APP_SCRIPT_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    const text = await res.text();
    alert('Objednávka byla odeslána. Děkujeme!');
    orders = [];
    renderOrders();
  } catch (err) {
    alert('Chyba při odesílání objednávky.');
    console.error(err);
  }
});

loadWeekMenu();
</script>
</body>
</html>






