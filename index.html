<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Objedn√°vky j√≠delny</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f5f7; margin:0; padding:20px; display:flex; justify-content:center;}
  .container { max-width:900px; width:100%; }
  .days { display:flex; gap:10px; margin-bottom:20px; flex-wrap: wrap; }
  .day-card { flex:1; padding:12px; background:#fff; border-radius:12px; text-align:center; cursor:pointer;
    box-shadow:0 2px 8px rgba(0,0,0,0.08); transition: transform 0.2s, background 0.2s; }
  .day-card:hover { transform: translateY(-2px); background:#e8f0ff; }
  .day-card.active { background:#2563eb; color:#fff; box-shadow:0 4px 12px rgba(0,0,0,0.15); }
  .menu-card, .order-card { background:#fff; border-radius:12px; padding:20px; margin-bottom:20px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
  label { display:block; margin-top:10px; }
  select, input[type="number"], input[type="text"] { width:100%; padding:8px; margin-top:4px; border-radius:8px; border:1px solid #ccc; }
  button { margin-top:12px; padding:12px 20px; border:none; border-radius:12px; background:#2563eb; color:#fff; font-size:16px; cursor:pointer; transition: background 0.2s; }
  button:hover { background:#1e4bb8; }
  button.delete { background:#ff4d4f; margin-left:10px; }
  .order-item { background:#f9fbff; padding:10px; border-radius:8px; margin-top:8px; display:flex; justify-content:space-between; align-items:center; }
  .hidden { display:none; }
</style>
</head>
<body>
<div class="container">
  <h1>J√≠delna ‚Äî objedn√°vky</h1>

  <div class="days" id="daysContainer"></div>

  <div class="menu-card hidden" id="menuCard">
    <h3 id="menuDayTitle"></h3>
    <div id="menuContent">
      <p><strong>Pol√©vka:</strong> <span id="menuPolevka"></span></p>
      <p><strong>J√≠dlo 1:</strong> <span id="menuJidlo1"></span></p>
      <p><strong>J√≠dlo 2:</strong> <span id="menuJidlo2"></span></p>
    </div>
    <div id="menuSelection">
      <label>Typ menu:
        <select id="menuTypeSelect">
          <option value="Cel√© menu">Cel√© menu</option>
          <option value="Poloviƒçn√≠ menu">Poloviƒçn√≠ menu</option>
          <option value="P≈Øl+P≈Øl menu">P≈Øl+P≈Øl menu</option>
          <option value="Hlavn√≠ j√≠dlo">Hlavn√≠ j√≠dlo</option>
          <option value="Poloviƒçn√≠ hlavn√≠ j√≠dlo">Poloviƒçn√≠ hlavn√≠ j√≠dlo</option>
          <option value="Pol√©vka">Pol√©vka</option>
        </select>
      </label>
      <label id="selectMainLabel" class="hidden">Vyber hlavn√≠ j√≠dlo:
        <select id="selectMain">
          <option value="jidlo1">J√≠dlo 1</option>
          <option value="jidlo2">J√≠dlo 2</option>
        </select>
      </label>
      <label>Poƒçet porc√≠:
        <input type="number" id="portionCount" min="1" value="1">
      </label>
      <button id="addOrderBtn">P≈ôidat do objedn√°vky</button>
    </div>
  </div>

  <div class="order-card" id="ordersCard">
    <h3>Fin√°ln√≠ objedn√°vka</h3>
    <div id="orderList"></div>
    <p><strong>Celkem:</strong> <span id="totalPrice">0</span> Kƒç</p>

    <label>Jm√©no:
      <input type="text" id="userName" placeholder="Va≈°e jm√©no">
    </label>
    <label>Kontakt (nap≈ô. e-mail nebo telefon):
      <input type="text" id="userContact" placeholder="Kontakt">
    </label>
    <label>Doruƒçen√≠:
      <select id="deliverySelect">
        <option value="Vyzvednu">Vyzvednu</option>
        <option value="P≈ôiv√©zt">P≈ôiv√©zt</option>
      </select>
    </label>
    <label id="addressLabel" class="hidden">Adresa:
      <input type="text" id="addressInput" placeholder="Ulice, ƒç√≠slo, mƒõsto">
    </label>

    <button id="submitOrderBtn">Odeslat objedn√°vku</button>
  </div>
</div>

<script>
const APP_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwsLo9ODVT6yd7ZuyznnbafAOyhICrT9Uwrf1esU8FdOsY2tAtbtQCFop1xCp9OV4Yx/exec';

let weekMenu = [];
let priceList = {
  'Pol√©vka': 40,
  'Hlavn√≠ j√≠dlo': 135,
  'Poloviƒçn√≠ menu': 115,
  'Cel√© menu': 155,
  'Poloviƒçn√≠ hlavn√≠ j√≠dlo': 115,
  'P≈Øl+P≈Øl menu': 155
};
let activeDayIndex = null;
let orders = [];

const daysContainer = document.getElementById('daysContainer');
const menuCard = document.getElementById('menuCard');
const menuDayTitle = document.getElementById('menuDayTitle');
const menuPolevka = document.getElementById('menuPolevka');
const menuJidlo1 = document.getElementById('menuJidlo1');
const menuJidlo2 = document.getElementById('menuJidlo2');
const menuTypeSelect = document.getElementById('menuTypeSelect');
const selectMainLabel = document.getElementById('selectMainLabel');
const selectMain = document.getElementById('selectMain');
const portionCount = document.getElementById('portionCount');
const addOrderBtn = document.getElementById('addOrderBtn');
const orderList = document.getElementById('orderList');
const totalPriceEl = document.getElementById('totalPrice');
const submitOrderBtn = document.getElementById('submitOrderBtn');
const deliverySelect = document.getElementById('deliverySelect');
const addressLabel = document.getElementById('addressLabel');
const addressInput = document.getElementById('addressInput');
const userName = document.getElementById('userName');
const userContact = document.getElementById('userContact');

// --- LOCAL STORAGE ---
window.addEventListener('load', () => {
  const savedName = localStorage.getItem('userName');
  if (savedName) userName.value = savedName;
});
userName.addEventListener('input', () => {
  localStorage.setItem('userName', userName.value.trim());
});

// --- naƒçten√≠ menu t√Ωdne ---
async function loadWeekMenu() {
  try {
    const res = await fetch();
    if (!res.ok) throw new Error('Chyba s√≠≈•ov√©ho po≈æadavku ' + res.status);
    const data = await res.json();
    weekMenu = data.week.filter((_, i) => i < 5);
    renderDayCards();
  } catch(err) {
    console.error('Chyba p≈ôi naƒç√≠t√°n√≠ menu t√Ωdne:', err);
  }
}

// --- vykreslen√≠ karet dn≈Ø ---
function renderDayCards() {
  daysContainer.innerHTML = '';
  weekMenu.forEach((item, idx) => {
    const day = item.row;
    const div = document.createElement('div');
    div.className = 'day-card';
    const date = new Date(day.date);
    const formattedDate = date.toLocaleDateString('cs-CZ', { day:'2-digit', month:'2-digit' });
    div.textContent = `${day.dayName} (${formattedDate})`;
    div.addEventListener('click', () => selectDay(idx));
    daysContainer.appendChild(div);
  });
}

// --- v√Ωbƒõr dne ---
function selectDay(idx) {
  activeDayIndex = idx;
  const cards = document.querySelectorAll('.day-card');
  cards.forEach((c,i) => c.classList.toggle('active', i === idx));
  const day = weekMenu[idx].row;
  menuCard.classList.remove('hidden');
  const formattedDate = new Date(day.date).toLocaleDateString('cs-CZ', { day:'2-digit', month:'2-digit' });
  menuDayTitle.textContent = `${day.dayName} (${formattedDate})`;
  menuPolevka.textContent = day.polevka || '‚Äì';
  menuJidlo1.textContent = day.jidlo1 || '‚Äì';
  menuJidlo2.textContent = day.jidlo2 || '‚Äì';
  menuTypeSelect.value = 'Cel√© menu';
  selectMainLabel.classList.remove('hidden');
  portionCount.value = 1;
}

// --- volba typu menu ---
menuTypeSelect.addEventListener('change', () => {
  const t = menuTypeSelect.value;
  if (['Cel√© menu','Poloviƒçn√≠ menu','Hlavn√≠ j√≠dlo','Poloviƒçn√≠ hlavn√≠ j√≠dlo'].includes(t))
    selectMainLabel.classList.remove('hidden');
  else
    selectMainLabel.classList.add('hidden');
});

// --- doruƒçen√≠ ---
deliverySelect.addEventListener('change', () => {
  addressLabel.classList.toggle('hidden', deliverySelect.value !== 'P≈ôiv√©zt');
});

// --- p≈ôid√°n√≠ objedn√°vky ---
addOrderBtn.addEventListener('click', () => {
  if (activeDayIndex === null) return alert('Vyberte den!');
  const day = weekMenu[activeDayIndex].row;
  const type = menuTypeSelect.value;
  const mainChoice = selectMain.value;
  const qty = parseInt(portionCount.value, 10) || 1;
  const basePrice = priceList[type] || 0;
  const price = basePrice * qty;
  orders.push({ day: day.dayName, date: day.date, type, mainChoice, qty, price });
  renderOrders();
});

// --- vykreslen√≠ objedn√°vek ---
function renderOrders() {
  orderList.innerHTML = '';
  let total = 0;
  orders.forEach((o, i) => {
    total += o.price;
    const div = document.createElement('div');
    div.className = 'order-item';
    div.innerHTML = `<span>${o.day} | ${o.type}${o.mainChoice ? ' ‚Äì ' + o.mainChoice : ''} x${o.qty} = ${o.price} Kƒç</span>`;
    const btn = document.createElement('button');
    btn.textContent = 'Smazat';
    btn.className = 'delete';
    btn.addEventListener('click', () => { orders.splice(i,1); renderOrders(); });
    div.appendChild(btn);
    orderList.appendChild(div);
  });
  totalPriceEl.textContent = total;
}

// --- odesl√°n√≠ objedn√°vky ---
submitOrderBtn.addEventListener('click', async () => {
  if (orders.length === 0) return alert('≈Ω√°dn√° polo≈æka v objedn√°vce');
  const name = userName.value.trim();
  const contact = userContact.value.trim();
  const delivery = deliverySelect.value;
  const address = (delivery === 'P≈ôiv√©zt') ? addressInput.value.trim() : '';

  if (!name) return alert('Zadejte jm√©no');
  if (!contact) return alert('Zadejte kontakt');
  if (delivery === 'P≈ôiv√©zt' && !address) return alert('Zadejte adresu');

  const payload = { orders, name, contact, delivery, address };
  try {
    const res = await fetch(APP_SCRIPT_URL, {
      method: 'POST',
      //mode: 'no-cors', // üëà p≈ôidat pro bezpeƒçn√© odesl√°n√≠ bez CORS chyb
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    const text = await res.text();
    alert('Objedn√°vka byla odesl√°na. Dƒõkujeme!');
    orders = [];
    renderOrders();
  } catch (err) {
    alert('Chyba p≈ôi odes√≠l√°n√≠ objedn√°vky.');
    console.error(err);
  }
});

loadWeekMenu();
</script>
</body>
</html>



