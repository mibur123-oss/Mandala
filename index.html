<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Objednávka jídel</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f7f7f7; }
  h1 { text-align: center; }
  .days-cards { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; }
  .day-card { background: #fff; padding: 10px 20px; border-radius: 10px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2); text-align: center; flex: 1; max-width: 120px; transition: transform 0.2s; }
  .day-card:hover { transform: scale(1.05); }
  #menuCard { background: #fff; padding: 15px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); margin-bottom: 20px; }
  .hidden { display: none; }
  #menuSelection label { display: block; margin: 10px 0; }
  #menuSelection input, #menuSelection select { padding: 5px; border-radius: 5px; border: 1px solid #ccc; width: 100%; max-width: 200px; }
  button { padding: 8px 15px; border: none; border-radius: 10px; background-color: #4CAF50; color: white; cursor: pointer; transition: 0.2s; }
  button:hover { background-color: #45a049; }
  #ordersList div { background: #fff; padding: 8px; margin-bottom: 5px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
  #totalPrice { font-weight: bold; margin-top: 10px; }
</style>
</head>
<body>

<h1>Objednávka jídel</h1>

<div class="days-cards"></div>

<div id="menuCard" class="hidden">
  <h2>Jídelníček</h2>
  <div id="menuItems"></div>
  <div id="menuSelection"></div>
</div>

<h2>Seznam objednávek</h2>
<div id="ordersList"></div>
<div id="totalPrice">Celkem: 0 Kč</div>

<script>
const APP_SCRIPT_URL = 'https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLjJ9fj0-9c85IDKw_8ow3XkONcRAFWDCdBmyC5cUuCliOAfAhzDL36XncCTjxZ6mqnJac6nOR0MKZze7aICYDYkWbGHifp50c7HaMPcWj1xB5SUtdQCYzumn_Lv3zqwPI8hoknO5_ENW0TivOVU82oqRjktXT_SCmoCb56EpL809kbnmcUw0ZVrrnbXZ7WA3PvB5deVwvuW3H5RRv-YLtgIrMlZ7iZ7TCdMMkr6IAQYFAUXnsEIxTLdJsw3Jrfww_ZsyXA6naLW1DjhhHrRdCxG-rNIOQ&lib=M8RSYmDm7iYILavaBqKQXX_LnOro48G--';

const daysContainer = document.querySelector('.days-cards');
const menuCard = document.getElementById('menuCard');
const menuItemsDiv = document.getElementById('menuItems');
const menuSelection = document.getElementById('menuSelection');
const ordersList = document.getElementById('ordersList');
const totalPriceEl = document.getElementById('totalPrice');

let weekMenu = [];
let orders = [];
const prices = {
  'Polévka': 40,
  'Hlavní jídlo': 135,
  'Poloviční hlavní': 115,
  'Celé menu': 155,
  'Poloviční menu': 115,
  'Půl+Půl menu': 155
};

// načíst jídelníček pro celý týden
async function loadWeekMenu() {
  try {
    const res = await fetch(APP_SCRIPT_URL);
    const data = await res.json();
    weekMenu = data.week.filter((row, idx) => idx < 5); // jen pondělí–pátek
    renderDays();
  } catch (err) {
    console.error('Chyba načítání menu:', err);
  }
}

// vykreslit karty dnů
function renderDays() {
  daysContainer.innerHTML = '';
  weekMenu.forEach((day) => {
    const div = document.createElement('div');
    div.className = 'day-card';
    const date = new Date(day.row.date);
    div.innerHTML = `<strong>${day.row.dayName}</strong><br>${date.toLocaleDateString()}`;
    div.addEventListener('click', () => showMenu(day.row));
    daysContainer.appendChild(div);
  });
}

// zobrazit menu daného dne
function showMenu(dayRow) {
  menuCard.classList.remove('hidden');
  menuItemsDiv.innerHTML = `
    <div><strong>Polévka:</strong> ${dayRow.polevka || '-'}</div>
    <div><strong>Hlavní 1:</strong> ${dayRow.jidlo1 || '-'}</div>
    <div><strong>Hlavní 2:</strong> ${dayRow.jidlo2 || '-'}</div>
  `;
  menuSelection.innerHTML = `
    <label>
      Typ menu:
      <select id="menuType">
        <option value="Celé menu">Celé menu</option>
        <option value="Poloviční menu">Poloviční menu</option>
        <option value="Půl+Půl menu">Půl+Půl menu</option>
        <option value="Hlavní jídlo">Hlavní jídlo</option>
        <option value="Poloviční hlavní">Poloviční hlavní</option>
        <option value="Polévka">Polévka</option>
      </select>
    </label>
    <label>
      Počet porcí:
      <input type="number" id="menuQty" value="1" min="1">
    </label>
    <button id="addOrderBtn">Přidat do objednávky</button>
  `;
  document.getElementById('addOrderBtn').onclick = () => addOrder(dayRow);
}

// přidat položku do objednávky
function addOrder(dayRow) {
  const type = document.getElementById('menuType').value;
  const qty = parseInt(document.getElementById('menuQty').value, 10);
  orders.push({ day: dayRow.dayName, date: dayRow.date, type, qty, price: prices[type] * qty });
  renderOrders();
}

// vykreslit seznam objednávek
function renderOrders() {
  ordersList.innerHTML = '';
  let total = 0;
  orders.forEach((o, idx) => {
    total += o.price;
    const div = document.createElement('div');
    div.innerHTML = `<span>${o.day} ${o.type} x${o.qty} = ${o.price} Kč</span>`;
    const btn = document.createElement('button');
    btn.textContent = 'Smazat';
    btn.onclick = () => { orders.splice(idx, 1); renderOrders(); };
    div.appendChild(btn);
    ordersList.appendChild(div);
  });
  totalPriceEl.textContent = `Celkem: ${total} Kč`;
}

loadWeekMenu();
</script>

</body>
</html>
