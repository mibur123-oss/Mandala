<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Objednávka jídel</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-top: 20px;
    }
    h1 { text-align: center; }

    .loader {
      text-align: center;
      font-size: 18px;
      color: #555;
      padding: 40px;
    }

    .day-card {
      padding: 10px;
      margin: 8px 0;
      border-radius: 8px;
      background: #fafafa;
      cursor: pointer;
      border: 2px solid transparent;
    }
    .day-card.active {
      border-color: #007BFF;
      background: #e7f1ff;
    }

    .hidden { display: none; }

    .order-section input, .order-section select {
      width: 100%;
      padding: 8px;
      margin: 6px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    button {
      background: #007BFF;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
    }
    button:hover {
      background: #0056b3;
    }

    .summary {
      margin-top: 15px;
      background: #f8f8f8;
      padding: 10px;
      border-radius: 8px;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>Objednávka jídel</h1>

  <!-- Loader -->
  <div id="loader" class="loader">Načítám jídelníček…</div>

  <!-- Výběr dnů -->
  <div id="days" class="hidden"></div>

  <!-- Detail dne -->
  <div id="menuDetail" class="hidden"></div>

  <!-- Finální objednávka -->
  <div id="finalOrder" class="hidden">
    <h2>Finální objednávka</h2>

    <div class="order-section">
      <label>Jméno a příjmení:</label>
      <input id="name" type="text" autocomplete="name" placeholder="Zadejte své jméno">

      <label>Kontakt (telefon):</label>
      <input id="contact" type="tel" autocomplete="tel" placeholder="Zadejte telefon">

      <label>Doručení:</label>
      <select id="delivery">
        <option value="vyzvednu">Vyzvednu osobně</option>
        <option value="privest">Přivést na adresu</option>
      </select>

      <div id="addressSection" class="hidden">
        <label>Adresa:</label>
        <input id="address" type="text" autocomplete="street-address" placeholder="Zadejte adresu">
      </div>
    </div>

    <div class="summary">
      <h3>Souhrn objednávky:</h3>
      <div id="orderSummary"></div>
      <div id="totalPrice"></div>
    </div>

    <button id="sendOrder">Odeslat objednávku</button>
  </div>
</div>

<script>
const APP_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwd1mpQosHJxpTHtun7LXMltMEY1I5ZtvkcMcqfmrS7yJ3DfxgBh6twTCQdEHmkOcKs/exec';

let weekMenu = [];
let orders = {};
let selectedDay = null;

// --- načtení menu týdne ---
async function loadWeekMenu() {
  try {
    const res = await fetch(APP_SCRIPT_URL);
    if (!res.ok) throw new Error('Chyba síťového požadavku ' + res.status);
    const data = await res.json();

    weekMenu = data.week.filter((_, i) => i < 5); // pondělí–pátek
    renderDayCards();
    document.getElementById('loader').classList.add('hidden');
    document.getElementById('days').classList.remove('hidden');
  } catch(err) {
    console.error('Chyba při načítání menu týdne:', err);
    document.getElementById('loader').textContent = 'Nepodařilo se načíst jídelníček.';
  }
}

// --- render karet dnů ---
function renderDayCards() {
  const daysEl = document.getElementById('days');
  daysEl.innerHTML = '';
  weekMenu.forEach((day, index) => {
    const d = document.createElement('div');
    d.className = 'day-card';
    d.textContent = `${day.date} - ${day.day}`;
    d.onclick = () => showDayMenu(index, d);
    daysEl.appendChild(d);
  });
}

// --- zobrazení menu pro den ---
function showDayMenu(index, el) {
  document.querySelectorAll('.day-card').forEach(c => c.classList.remove('active'));
  el.classList.add('active');
  selectedDay = index;
  const day = weekMenu[index];

  const md = document.getElementById('menuDetail');
  md.classList.remove('hidden');
  md.innerHTML = `
    <h2>${day.day} (${day.date})</h2>
    <p><strong>Jídlo 1:</strong> ${day.jidlo1}</p>
    <p><strong>Jídlo 2:</strong> ${day.jidlo2}</p>

    <label>Typ menu:</label>
    <select id="menuType">
      <option value="">-- Vyberte --</option>
      <option value="cele">Celé menu</option>
      <option value="polovicni">Poloviční menu</option>
      <option value="hlavni">Hlavní jídlo</option>
      <option value="polovicni_hlavni">Poloviční hlavní jídlo</option>
    </select>

    <label>Výběr jídla:</label>
    <select id="mealChoice">
      <option value="1">Jídlo 1</option>
      <option value="2">Jídlo 2</option>
    </select>

    <button onclick="addToOrder()">Přidat do objednávky</button>
  `;

  // obnova z localStorage
  const saved = localStorage.getItem('menu_' + index);
  if (saved) {
    const s = JSON.parse(saved);
    document.getElementById('menuType').value = s.type;
    document.getElementById('mealChoice').value = s.choice;
  }
}

// --- přidání do objednávky ---
function addToOrder() {
  const type = document.getElementById('menuType').value;
  const choice = document.getElementById('mealChoice').value;
  if (!type) return alert('Vyberte typ menu.');

  const day = weekMenu[selectedDay];
  orders[day.date] = { day: day.day, type, choice };

  // uložit do localStorage
  localStorage.setItem('menu_' + selectedDay, JSON.stringify({ type, choice }));

  updateSummary();
  document.getElementById('finalOrder').classList.remove('hidden');
}

// --- souhrn ---
function updateSummary() {
  const summaryEl = document.getElementById('orderSummary');
  summaryEl.innerHTML = '';
  let total = 0;
  Object.entries(orders).forEach(([date, o]) => {
    const li = document.createElement('div');
    li.textContent = `${date} (${o.day}): ${o.type}, jídlo ${o.choice}`;
    summaryEl.appendChild(li);
    total += 100; // příkladová cena
  });
  document.getElementById('totalPrice').textContent = 'Celkem: ' + total + ' Kč';
}

// --- změna doručení ---
document.getElementById('delivery').addEventListener('change', (e) => {
  document.getElementById('addressSection').classList.toggle('hidden', e.target.value !== 'privest');
});

// --- načtení údajů z localStorage ---
window.addEventListener('load', () => {
  document.getElementById('name').value = localStorage.getItem('name') || '';
  document.getElementById('contact').value = localStorage.getItem('contact') || '';
  document.getElementById('address').value = localStorage.getItem('address') || '';
  loadWeekMenu();
});

// --- ukládání hodnot ---
['name','contact','address'].forEach(id => {
  document.getElementById(id).addEventListener('input', e => {
    localStorage.setItem(id, e.target.value);
  });
});

// --- odeslání objednávky ---
document.getElementById('sendOrder').addEventListener('click', async () => {
  const name = document.getElementById('name').value.trim();
  const contact = document.getElementById('contact').value.trim();
  const delivery = document.getElementById('delivery').value;
  const address = document.getElementById('address').value.trim();

  if (!name || !contact) return alert('Vyplňte jméno a kontakt.');
  if (delivery === 'privest' && !address) return alert('Vyplňte adresu.');

  const payload = { orders, name, contact, delivery, address };

  try {
    const res = await fetch(APP_SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify(payload),
      headers: { 'Content-Type': 'application/json' }
    });
    alert('Objednávka odeslána. Děkujeme!');
    orders = {};
    updateSummary();
  } catch (err) {
    console.error(err);
    alert('Nepodařilo se odeslat objednávku.');
  }
});
</script>

</body>
</html>
