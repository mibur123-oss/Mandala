<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Objednávky jídelny</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f7f8fb; }
  h1 { text-align:center; }
  #daysContainer { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-bottom:20px; }
  .day-card { background: #fff; border-radius: 10px; padding: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); width: 200px; }
  .menu-item { margin: 4px 0; }
  #ordersContainer { margin-top: 20px; }
  .order-item { background: #eef2ff; border-radius: 8px; padding: 8px; margin-bottom: 6px; }
  button { cursor:pointer; border:none; border-radius: 8px; padding:6px 10px; background: #2563eb; color:#fff; }
  button:hover { background:#1e4bb8; }
  input[type="number"] { width: 50px; }
</style>
</head>
<body>
<h1>Objednávky jídelny</h1>

<div id="daysContainer">
  <!-- Karty dnů budou vloženy sem -->
</div>

<h2>Objednávka</h2>
<div id="ordersContainer">
  <!-- Seznam přidaných objednávek -->
</div>
<button id="submitOrderBtn">Odeslat objednávku</button>

<script>
const APPS_SCRIPT_URL = "https://script.googleusercontent.com/macros/echo?user_content_key=AehSKLjJ9fj0-9c85IDKw_8ow3XkONcRAFWDCdBmyC5cUuCliOAfAhzDL36XncCTjxZ6mqnJac6nOR0MKZze7aICYDYkWbGHifp50c7HaMPcWj1xB5SUtdQCYzumn_Lv3zqwPI8hoknO5_ENW0TivOVU82oqRjktXT_SCmoCb56EpL809kbnmcUw0ZVrrnbXZ7WA3PvB5deVwvuW3H5RRv-YLtgIrMlZ7iZ7TCdMMkr6IAQYFAUXnsEIxTLdJsw3Jrfww_ZsyXA6naLW1DjhhHrRdCxG-rNIOQ&lib=M8RSYmDm7iYILavaBqKQXX_LnOro48G--";

const daysContainer = document.getElementById('daysContainer');
const ordersContainer = document.getElementById('ordersContainer');
const submitOrderBtn = document.getElementById('submitOrderBtn');
let orders = [];

async function loadWeekMenu() {
  try {
    const res = await fetch(APPS_SCRIPT_URL);
    if(!res.ok) throw new Error("Chyba při načítání dat z Apps Script");
    const data = await res.json();
    if(!data.week || data.week.length===0) return;

    const weekDays = data.week.filter(item => {
      const d = item.row.dayName.toLowerCase();
      return ['pondělí','úterý','středa','čtvrtek','pátek'].includes(d);
    });

    daysContainer.innerHTML = '';
    weekDays.forEach(d => {
      const row = d.row;
      const card = document.createElement('div');
      card.className = 'day-card';
      card.innerHTML = `
        <h3>${row.dayName} — ${new Date(row.date).toLocaleDateString('cs-CZ')}</h3>
        <div class="menu-item"><strong>Polévka:</strong> ${row.polevka || '-'}</div>
        <div class="menu-item"><strong>Hlavní 1:</strong> ${row.jidlo1 || '-'}</div>
        <div class="menu-item"><strong>Hlavní 2:</strong> ${row.jidlo2 || '-'}</div>
        <div style="margin-top:8px;">
          <label>Typ menu:
            <select class="menuType">
              <option value="Celé menu">Celé menu</option>
              <option value="Poloviční menu">Poloviční menu</option>
              <option value="Půl+Půl menu">Půl+Půl menu</option>
              <option value="Hlavní jídlo">Hlavní jídlo</option>
              <option value="Poloviční hlavní jídlo">Poloviční hlavní jídlo</option>
              <option value="Polévka">Polévka</option>
            </select>
          </label>
          <label style="margin-left:6px;">Počet porcí:
            <input type="number" class="portionCount" min="1" value="1">
          </label>
          <button class="addOrderBtn">Přidat</button>
        </div>
      `;
      daysContainer.appendChild(card);

      card.querySelector('.addOrderBtn').addEventListener('click', () => {
        const type = card.querySelector('.menuType').value;
        const count = parseInt(card.querySelector('.portionCount').value);
        orders.push({ day: row.dayName, date: row.date, type, count });
        renderOrders();
      });
    });

  } catch(err) {
    console.error(err);
  }
}

function renderOrders() {
  ordersContainer.innerHTML = '';
  orders.forEach((o, idx) => {
    const div = document.createElement('div');
    div.className = 'order-item';
    div.textContent = `${o.day} (${new Date(o.date).toLocaleDateString('cs-CZ')}): ${o.type} x${o.count}`;
    const delBtn = document.createElement('button');
    delBtn.textContent = 'Smazat';
    delBtn.style.marginLeft = '10px';
    delBtn.addEventListener('click', ()=> {
      orders.splice(idx,1);
      renderOrders();
    });
    div.appendChild(delBtn);
    ordersContainer.appendChild(div);
  });
}

submitOrderBtn.addEventListener('click', () => {
  if(orders.length===0){ alert("Žádná objednávka"); return; }
  console.log("Odesílám objednávku:", orders);
  alert("Objednávka odeslána (simulace)");
  orders = [];
  renderOrders();
});

loadWeekMenu();
</script>
</body>
</html>
